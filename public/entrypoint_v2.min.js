var http = {
    get: function (url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(xhr.responseText);
            }
        };
        xhr.open('GET', url, true);
        xhr.send(null);
    }
};
var query = {
    get: function (name) {
        name = name.replace(/[\[\]]/g, "\\$&");
        var url = window.location.href;
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
        if (!results) {
            return null;
        }
        if (!results[2]) {
            return '';
        }
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    },
    has: function (name) {
        if (null === this.get(name)) {
            return false;
        }
        return true;
    }
};
var cookie = {
    set: function (name, value, domain) {
        var secure = ''
        if(window.location.protocol === 'https:') {
            secure = 'Secure;'
        }
        var time = new Date();
        time.setFullYear(time.getFullYear()+2);
        document.cookie = name + '=' + value + ';expires=' + time + ';path=/;domain=.' + domain + ';'+secure+'samesite=Lax';
    },
    get: function (name) {
        var cookie = {};
        document.cookie.split(";").forEach(function (el) {
            var [k, v] = el.split("=");
            cookie[k.trim()] = v;
        });
        return cookie[name] ?? null;
    },
    has: function (name) {
        return null !== this.get(name);

    }
};
var util = {
    domain: function () {
        var domain = window.location.hostname;
        if (domain === '127.0.0.1') {
            return domain;
        }
        var domainParts = domain.split('.').filter(Boolean);
        if (domainParts[0] === 'www') {
            delete domainParts[0];
            domainParts = domainParts.filter(Boolean);
        }
        domainParts = domainParts.reverse();
        domain = domainParts[1] + '.' + domainParts[0];
        if (domainParts[0].length <= 3 &&
            domainParts[1].length <= 3 &&
            typeof domainParts[2] !== 'undefined'
        ) {
            domain = domainParts[2] + '.' + domainParts[1] + '.' + domainParts[0];
        }
        return domain;
    },
    env: function () {
        const domain = this.domain();
        var env = '';
        if (domain === '127.0.0.1' ||
            window.location.hostname.includes('staging.trackmytarget.com')
        ) {
            env = 'staging.';
        }
        return env;
    },
    protocol: function () {
        if(this.env() === 'staging.') {
            return 'http';
        }
        return 'https';
    }
};
(function () {
    const params = {
        // Default linking
        tmt_offer_sid: 'offer sID',
        tmt_ufp: 'user fingerprint ID',
        tmt_data: 'event ID'
    };
    for (var key in params) {
        if (query.has(key)) {
            window[key] = query.get(key);
        }
    }
    if (typeof window['tmt_data'] !== 'undefined') {
        cookie.set('tc_' + window['tmt_offer_sid'], window['tmt_data'], util.domain());
    }
    if (typeof window['tmt_ufp'] !== 'undefined') {
        cookie.set('tc_ufp', window['tmt_ufp'], util.domain());
    }

})();
